---
title: "p8105_hw2"
author: "Liner Ge"
date: "2020/9/27"
output: github_document
---

```{r setup}
library(tidyverse)
library(readxl)
```
# Problem 1

Read the Mr. Trashwheel dataset.

```{r}
trashwhell_df=
  read_xlsx(
    "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet="Mr. Trash Wheel",
    range=cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(
    sports_balls= round(sports_balls),
    sports_balls= as.integer(sports_balls)
  )

```

Read precipitation data for 2017 and 2018

```{r}
precip_2018=
  read_xlsx("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet="2018 Precipitation",
    skip=1,
  ) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year=2018) %>% 
  relocate(year)

precip_2017=
  read_xlsx("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet="2017 Precipitation",
    skip=1,
  ) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year=2017) %>% 
  relocate(year)
```

Combine annual precipitation.

```{r}
precip_df=
  bind_rows(precip_2017,precip_2018) %>% 
  mutate(month=month.name[month])
```

This dataset contains information from the Mr. Trashwhell collector in Baltimore, Maryland. As trash enters the harbor, the trashwhell collect the trash, and stores it in a dumpster. The dataset contains information on year, month, and trash collected, include some specific kinds of trash. There are a total of `r nrow(trashwhell_df)` rows in our final dataset. Additional data sheet include month precipitation data. There are a total of `r nrow(precip_df)` rows in month precipitation dataset.The total precipitation in 2018 is `r sum(pull(precip_2018,total))`. The median number of sports balls in a dumpster in 2017 is `r median(pull(select(filter(trashwhell_df, year == 2017),sports_balls),sports_balls))`.

# Problem 2

Read NYC Transit data.
```{r}
transit_df=
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line, station_name, station_latitude, station_longitude, route1:route11, entry, vending, entrance_type, ada) %>% 
  mutate(entry= recode(entry, YES= TRUE, NO= FALSE))
```
This is a NYC transit dataset. It contains following variables:`r names(transit_df)`. My data cleaning steps:1) I use janitor::clean_names to clean up variables names and convert them to lower snake case.2) I select important variables and remove others. The dimension of this dataset is `r nrow(transit_df)`Ã—`r ncol(transit_df)`.

Answer the following questions:

(1) There are `r nrow(distinct(transit_df,line,station_name))`  distinct stations.

(2) `r filter(transit_df, ada=="TRUE") %>% distinct(line,station_name) %>% nrow()` distinct stations are ADA compliant.

(3) The proportion of distinct station entrances / exits without vending allow entrance is `r filter(transit_df, entry=="TRUE" & vending== "NO") %>% distinct(line,station_name) %>% nrow()/nrow(distinct(filter(transit_df, vending== "NO") ,line,station_name))`.

```{r}
reformat_data = 
  transit_df %>% 
  mutate_at(vars(route1:route11),as.factor) %>% 
  pivot_longer(
    route1:route11,
    names_to= "route_name",
    names_prefix = "route",
    values_to ="route_number") %>% 
  drop_na(route_number)
  
```

(1) `r filter(reformat_data, route_number=="A") %>% distinct(line,station_name) %>% nrow()` distinct stations serve the A train.

(2) Of the stations that serve the A train, `r filter(reformat_data, route_number=="A"& ada=="TRUE") %>% distinct(line,station_name) %>% nrow()` are ADA compliant.

